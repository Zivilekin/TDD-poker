const path = require('path');

const modulesAbsolutePath = path.resolve(process.cwd(), 'node_modules');
const REGEX_CSS_IMPORT = /@import\s+['"]~([^'"]+)['"]/gm;

module.exports.isProduction = () => (process.env.NODE_ENV || '').toLowerCase() === 'production';

module.exports.isCI = () => !!(
  process.env.CONTINUOUS_INTEGRATION ||
  process.env.BUILD_NUMBER ||
  process.env.TEAMCITY_VERSION ||
  false
);

module.exports.tryRequire = pkg => {
  try {
    return require(pkg);
  } catch (e) {
    return null;
  }
};

module.exports.isSass = fileName => {
  return fileName && ['.sass', '.scss'].indexOf(path.extname(fileName)) > -1;
};

module.exports.replaceSassWebpackImports = sass => {
  return sass.replace(REGEX_CSS_IMPORT, (match, offset) =>
    `@import '${path.join(modulesAbsolutePath, offset)}'`
  );
};
